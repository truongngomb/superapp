# ==============================================================================
# SUPERAPP - SUPERVISOR CONFIGURATION
# ==============================================================================
# Manages two services in the Docker container:
#   1. Nginx - Frontend static files + API proxy (port 80)
#   2. API Server - Express backend via tsx (port 3001)
# ==============================================================================

[supervisord]
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid
user=root

# ==============================================================================
# NGINX - Frontend & Reverse Proxy
# ==============================================================================
[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
startretries=5
startsecs=5
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10

# ==============================================================================
# API SERVER - Express Backend (using tsx)
# ==============================================================================
[program:api-server]
# Run directly with pnpm exec tsx to avoid extra shell wrapping
command=pnpm --filter @superapp/api-server exec tsx src/index.ts
directory=/app
autostart=true
autorestart=true
startretries=10
startsecs=10
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=20
environment=NODE_ENV="production",PORT="3001",HOST="0.0.0.0"
